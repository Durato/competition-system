<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard - Technovação</title>
  <!-- CSP: Segurança reforçada para o painel administrativo -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data: http: https:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://sdk.mercadopago.com https://*.mlstatic.com; style-src 'self' 'unsafe-inline'; connect-src 'self' http: https: https://api.mercadopago.com https://*.mercadopago.com; frame-src https://www.mercadopago.com https://*.mercadopago.com;">
  <link rel="stylesheet" href="styles.css"/>
  <!-- Mercado Pago SDK -->
  <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>
<body>

<!-- LOADING OVERLAY -->
<div id="loadingOverlay">
  <div class="spinner"></div>
</div>

<!-- CONFIRMATION MODAL -->
<div class="modal" id="confirmModal">
  <div class="modal-box" style="text-align: center;">
    <h2 id="confirmTitle">Tem certeza?</h2>
    <p id="confirmMessage" style="color: #ccc; margin-bottom: 25px;">Essa ação não pode ser desfeita.</p>
    <div style="display: flex; gap: 10px; justify-content: center;">
      <button id="btnConfirmYes" style="background-color: #ef4444; min-width: 100px;">Sim</button>
      <button onclick="closeModal('confirm')" style="background: transparent; border: 1px solid var(--border); color: var(--text); min-width: 100px;">Cancelar</button>
    </div>
  </div>
</div>

<!-- PAYMENT MODAL -->
<div class="modal" id="paymentModal">
  <div class="payment-modal-box">
    <button class="close-modal-btn" onclick="closePaymentModal()">&times;</button>
    <h2 style="margin-top: 0;">Finalizar Pagamento</h2>
    <p id="paymentTotalDisplay" style="font-size: 1.2rem; color: var(--primary); font-weight: bold; margin-bottom: 20px;"></p>

    <!-- Mercado Pago Logo -->
    <div style="text-align: center; margin-bottom: 15px;">
      <img src="https://logodownload.org/wp-content/uploads/2019/06/mercado-pago-logo.png"
           alt="Mercado Pago"
           style="max-width: 180px; height: auto;">
    </div>

    <!-- Tabs -->
    <div class="payment-tabs">
      <button class="payment-tab active" onclick="switchPaymentTab('pix')">PIX</button>
      <button class="payment-tab" onclick="switchPaymentTab('card')">Cartão de Crédito</button>
    </div>

    <!-- PIX Content -->
    <div id="pixContent" class="payment-content active">
      <div id="pixLoading" style="text-align: center; padding: 20px;">
        <div class="spinner" style="margin: 0 auto;"></div>
        <p style="margin-top: 10px;">Gerando código PIX...</p>
      </div>
      <div id="pixResult" style="display: none;">
        <div style="text-align: center; margin-bottom: 20px;">
          <img id="pixQRCode" src="" alt="QR Code PIX" style="max-width: 250px; border: 2px solid var(--border); border-radius: 8px;">
        </div>
        <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
          <label style="display: block; font-size: 0.9rem; color: #aaa; margin-bottom: 5px;">Código PIX (Copia e Cola):</label>
          <div style="display: flex; gap: 10px;">
            <input type="text" id="pixCode" readonly style="flex: 1; background: #1a1a1a; color: var(--text); font-family: monospace; font-size: 0.85rem;">
            <button onclick="copyPixCode()" style="flex-shrink: 0;">Copiar</button>
          </div>
        </div>
        <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid #22c55e; border-radius: 8px; padding: 15px;">
          <p style="margin: 0; font-size: 0.9rem; color: #22c55e;">
            <strong>Instruções:</strong><br>
            1. Abra o app do seu banco<br>
            2. Escolha pagar com PIX<br>
            3. Escaneie o QR Code ou cole o código acima<br>
            4. Confirme o pagamento<br>
            5. Aguarde a confirmação (pode levar alguns segundos)
          </p>
        </div>
        <p style="text-align: center; margin-top: 15px; font-size: 0.85rem; color: #aaa;">
          O pagamento será confirmado automaticamente após a aprovação.
        </p>
      </div>
    </div>

    <!-- Credit Card Content -->
    <div id="cardContent" class="payment-content">
      <div id="cardPaymentBrick_container"></div>
      <div id="cardPaymentError" style="display: none; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 8px; padding: 15px; margin-top: 15px;">
        <p id="cardPaymentErrorMessage" style="margin: 0; color: #ef4444; font-size: 0.9rem;"></p>
      </div>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">

  <header>
    <h2 id="userName">Usuário</h2>
    <button onclick="logout()">Sair</button>
  </header>

  <!-- ALOJAMENTO -->
  <section style="border-color: #8b5cf6;">
    <h3 style="color: #8b5cf6;">Alojamento</h3>
    <p style="font-size: 0.9rem; color: #aaa; margin-bottom: 15px;">
      Vagas restantes: <strong id="accommodationRemaining" style="color: #8b5cf6;">--</strong> / 200
    </p>
    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--text);">
      <input type="checkbox" id="accommodationToggle" onchange="toggleAccommodation()" style="width: auto; margin: 0;" />
      Preciso de alojamento
    </label>
    <p id="accommodationMessage" style="font-size: 0.85rem; margin-top: 8px;"></p>
  </section>

  <!-- EQUIPES -->
  <section>
    <h3>Minhas Equipes</h3>
    <div id="teamSection"></div>
  </section>

  <!-- MEMBROS -->
  <section id="membersSection" style="display:none">
    <h3>Membros</h3>
    <ul id="membersList"></ul>
    <div id="addMemberArea">
      <h4 style="margin-top: 1rem; margin-bottom: 0.5rem; color: var(--primary);">Adicionar Membro</h4>
      <div id="memberMessage" style="margin-bottom: 0.5rem; font-size: 0.9rem; color: #f87171;"></div>
      <form onsubmit="handleAddMember(event)">
        <input id="memberEmail" type="email" placeholder="Email do membro" required />
        <button>Adicionar</button>
      </form>
    </div>
  </section>

  <!-- ROBÔS -->
  <section id="teamRobotsSection" style="display:none">
    <h3>Robôs</h3>
    <ul id="teamRobotsList"></ul>
  </section>

  <!-- CADASTRAR ROBÔ -->
  <section id="robotSection" style="display:none">
    <h3>Cadastrar Robô</h3>
    <div id="robotMessage"></div>
    <form onsubmit="handleCreateRobot(event)">
      <input id="robotName" placeholder="Nome do robô" required />
      <label for="robotPhoto" style="display: block; margin-top: 10px; margin-bottom: 5px; color: var(--text); font-size: 0.9rem;">Foto do robô</label>
      <input type="file" id="robotPhoto" accept="image/*" style="background: var(--surface); color: var(--text);" required />
      <select id="robotCategory" required>
        <option value="">Selecione categoria</option>
      </select>
      <button>Cadastrar</button>
    </form>
  </section>

  <!-- PAGAMENTOS -->
  <section id="paymentSection" style="display:none; border-color: #22c55e;">
    <h3 style="color: #22c55e;">Pagamentos Pendentes</h3>
    <p style="font-size: 0.9rem; color: #aaa; margin-bottom: 20px;">Selecione os itens para pagar (Apenas Líder) — <span style="color: #f87171;">Limite de 400 inscritos pagos no evento.</span></p>
    
    <div id="paymentList">
      <!-- Checkboxes serão gerados aqui -->
    </div>

    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
      <h3 id="totalPrice" style="margin:0;">Total: R$ 0,00</h3>
      <button onclick="handleCheckout()" style="background-color: #22c55e;">Pagar Agora</button>
    </div>
  </section>

  <!-- CRIAR EQUIPE -->
  <section>
    <h3>Criar Nova Equipe</h3>
    <div id="createTeamMessage" style="margin-bottom: 10px; font-size: 0.9rem;"></div>
    <form onsubmit="handleCreateTeam(event)">
      <input id="teamName" placeholder="Nome da equipe" required />
      <input id="teamInstitution" placeholder="Instituição de Ensino / Empresa" required />
      <label for="teamPhoto" style="display: block; margin-top: 10px; margin-bottom: 5px; color: var(--text); font-size: 0.9rem;">Foto da equipe</label>
      <input type="file" id="teamPhoto" accept="image/*" style="background: var(--surface); color: var(--text);" required />
      <button>Criar Equipe</button>
    </form>
  </section>

  <div class="card">
    <h3>Robôs por Categoria</h3>
    <div id="robotsByCategory" class="robots-grid"></div>
  </div>

</div>

<script src="config.js?v=4"></script>
<script src="validators.js?v=4"></script>
<script src="app.js?v=9"></script>
<script src="payment.js?v=10"></script>
</body>
</html>